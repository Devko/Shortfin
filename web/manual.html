<html>
<head>
	<title>Manual | Shortfin</title>
	
	<link href="/css/stylesheet.css" type="text/css" rel="stylesheet" />
</head>

<body>
	<div class="menu">
		<ul>
			<li>
				<a href="index.html">About</a>
			</li>			
			<li>
				<a href="benchmarks.html">Benchmarks</a>
			</li>
			<li>
				<a href="download.html">Download</a>
			</li>
			<li>
				<a href="manual.html">Manual</a>
			</li>
		</ul>
	</div>

	<div class="header">
		<div id="header_img">
			<img src="img/logo.png" height="110" />
		</div>
		<div id="header_text">
			<h1>Shortfin</h1>
			<span style="color: #ffffff; font-size: 12px;">An extremely fast web server</span>
		</div>
	</div>
	
	<div class="content">
		<h2>Install</h2>
		<p>
			<a href="#install">Install Shortfin</a><br />
			<a href="#config">Configure the server</a><br />
			<!--a href="#config_proxy">Configure the reverse proxy</a><br /-->
			<a href="#start">Start / stop the server</a>
		</p>
	
		<br /><br />
	
		<a name="install"></a>
		<h2>Install Shortfin</h2>
		<p>
			First, <a href="download.html">download</a> the package and then follow these instructions:
			
			<ul>
				<li>
					Unpack it:
					<br /><br />
					<code>
						$ gzip -cd shortfin-0.9.1.tar.gz | tar xf -<br />
						$ cd shortfin
					</code>
				</li>			
				<li>
					Compile and install it by running these commands:
					<br /><br />
					<code>
						# ./configure<br />
						# make<br />
						# make install<br />
						# /etc/init.d/shortfin start
					</code>
				</li>
				<li>
					Shortfin is installed, now you just have to configure it.
				</li>
			</ul>
		</p>
		
		<a name="config"></a>
		<h2>Configure the server</h2>
		<p>
			To get the best performance out of the server it's important that you configure it right.
	
			<ul>
				<li>
					Open the config file:
					<br /><br />
					<span>/etc/shortfin/shortfin.conf</span>
				</li>			
				<li>
					Set <b>master server settings</b>
					<br /><br />
					These settings will affect the entire server. 
					Try different configurations to get the best performance for your needs.
					<br /><br />
					
					<code>
						<comment>## MASTER SERVER SETTINGS ##<br />
						############################</comment><br />
						<br />
						<comment>## chroot for all processes<br />
						#chroot = /</comment><br />
						<br />
						<comment>## number of worker processes to spawn.<br />
						## should be equal to the number of cores in your server.</comment><br />
						max-workers = 1<br />
						<br />
						<comment>## stack size for child processes. <br />
						## should be 128000+ or it may fail.</comment><br />
						child-stack-size = 128000<br />
						<br />
						<comment>## 1 = running in background<br />
						## 0 = running in the terminal</comment><br />
						daemonize = 1<br />
						<br />
						<comment>## how many pending connections that is accepted.</comment><br />
						max-pending = 50000<br />
						<br />
						<comment>## how many clients / connections it can hold at a time.</comment><br />
						max-clients = 50000<br />
						<br />
						<comment>## read and write buffer sizes</comment><br />
						read-buffer-size  = 4046<br />
						write-buffer-size = 131072<br />
						<br />
						<comment>## enable / disable the Nagle (TCP No Delay) algorithm<br />
						## 1 = disabled<br />
						## 0 = enabled</comment><br />
						tcp-nodelay = 1<br />
					</code>
				</li>
				<li>
					Set <b>global settings</b>
					<br /><br />
					Configure cache settings etc.<br />
					These settings can be changes for each virtual server you create.
					<br /><br />
					
					<code>
						<comment>## GLOBAL SETTINGS ##<br />
						#####################</comment><br />
						<br />
						<comment>## listening port</comment><br />
						listen-port = 80<br />
						<br />
						<comment>## server name used in headers<br />
						## default = Shortfin/0.9</comment><br />
						server-name = Shortfin/0.9<br />
						<br />
						<comment>## document root for all files.<br /> 
						## allways end with a '/'</comment><br />
						doc-root = /var/www/<br />
						<br />
						<comment>## index file</comment><br />
						index-file = index.html<br />
						<br />
						<br /><br />
						<comment>## cache files. <br />
						## yes = cache whole HTTP packets<br />
						## fd  = cache only file descriptors<br />
						## no  = cache nothing</comment><br />
						cache-files = yes<br />
						<br />
						<comment>## if cache-files = yes, specify how many bytes that will be used for caching.</comment><br />
						cache-memory-size = 300000000<br />
						<br />
						<comment>## if cache-files = yes, specify the upper limit when the cache should be turned off.<br />
						## if not specified, cache-memory-size - 10%. <br />
						## if you choose the same as memory-size, the cache must be filled exacty that many bytes,<br />
						## which will probably not happen.</comment><br />
						cache-turn-off-limit = 295000000<br />
						<br />
						<comment>## if cache-files = fd, specify maximum number of open file descriptors.<br />
						## don't forget that max-clients also uses file descriptors.<br />
						## when this number has been reached, the server will switch over to none-cache mode for all new files.<br />
						#cache-max-fds = 30000</comment><br />
						<br />
						<comment>## if cache-files = yes, specify where on disc to save the cache files.<br />
						## allways end with a '/'</comment><br />
						cache-dir = /var/www/cache/<br />
					</code>
				</li>
				<li>
					Setup your <b>virtual servers</b>
					<br /><br />
					All settings in <i>global settings</i> can be changed in a virtual server.<br />
					Settings that are not set will be inherited from the global settings.
					<br /><br />
					
					<code>
						<comment>## VIRTUAL SERVERS ##<br />
						#####################<br />
						## create virtual server with their own settings, caches etc.<br />
						## set all properies inside server = {}<br />
						## all properies that are not set will inherit from the global settings below this section.<br />
						## (except master server settings)<br />
						##<br />
						## specify default server by default = 1.<br />
						## before the server has detemined which server to use, it will use the default server.<br />
						<br /></comment>
						<comment># default server</comment><br />
						server = {<br />
						&nbsp;&nbsp;default = 1<br />
						&nbsp;&nbsp;doc-root = /var/www/<br />
						&nbsp;&nbsp;host-name = localhost www.example.com<br />
						}<br />
					</code>
				</li>
			</ul>
		</p>
		
		<!--a name="config_proxy"></a>
		<h2>Configure the reverse proxy</h2>
		<p>
			Shortfin is not only a static web server, it is alsp a reverse proxy with cache.
			<ul>
				<li>
					Open the config file:
					<br /><br />
					<span>/etc/shortfin/shortfin.conf</span>
				</li>
				
				<li>
					Create a proxy inside a server-configuration:
					<br /><br />
					
					<code>
						proxy = {<br />
						&nbsp;&nbsp;new-rule = ext .php<br />
						&nbsp;&nbsp;new-rule = ext .cgi<br />
						<br />
						&nbsp;&nbsp;host = 192.168.0.12<br />
						&nbsp;&nbsp;port = 80<br />
						<br />
						&nbsp;&nbsp;cache = 0<br />
						}<br />
						<br />
						<comment>## proxy all images to an image server</comment><br />
						proxy = {<br />
						&nbsp;&nbsp;new-rule = dir   /img<br />
						&nbsp;&nbsp;new-rule = file  /logo.png<br />
						&nbsp;&nbsp;new-rule = ip    192.168.0.100<br />
						<br />
						&nbsp;&nbsp;host = 192.168.0.100<br />
						&nbsp;&nbsp;port = 8080<br />
						<br />
						&nbsp;&nbsp;cache = 1<br />
						}<br />
					</code>
				</li>
			</ul>
		</p-->
		
		<a name="start"></a>
		<h2>Start / Stop the server</h2>
		<p>To start the server, type following:</p>
			<ul>
				<li>
					<code>
						# /etc/init.d/shortfin start
					</code>
					<br />
					or:<br /><br />
					<code>
						# shortfin - c &lt;config-file&gt;
					</code>
				</li>
			</ul>
			
			<p>To stop the server, type following:</p>
			<ul>
				<li>
					<code>
						# /etc/init.d/shortfin stop
					</code>
				</li>
			</ul>

	</div>
	
	<div class="footer">
		Copyright &copy; Timothy E. Johansson, 2011<br />
	</div>
</body>
</html>
